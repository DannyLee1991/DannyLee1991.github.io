title: 斯坦福机器学习课程 第六周 (3)机器学习系统设计-[构建垃圾邮件分类器][误差分析]
tags:
  - 机器学习
  - 斯坦福课程
categories:
  - 机器学习
comments: true
date: 2016-12-18 17:51:58
mathjax: true
---

## 构建垃圾邮件分类器

> 在接下来的视频中，我将谈到机器学习的系统设计。
> 
> 这些视频将谈及在设计复杂的机器学习系统时，你将遇到的主要问题。同时我们会试着给出一些关于如何巧妙构建一个复杂的机器学习系统的建议。
> 
> 接下来的视频可能看起来有点不连贯，因为这些视频会涉及一些你在设计机器学习系统时可能会遇到的不同问题。虽然下面的课程数学性可能不是那么的强，但是我认为我们将要讲到的这些东西是非常有用的。可能在构建大型机器学习系统时节省大量的时间。

### 先想想第一步做什么

[视频地址](https://www.coursera.org/learn/machine-learning/lecture/4h5X4/prioritizing-what-to-work-on)

具体的说，我们首先要讲的是当我们在进行机器学习时，着重要考虑什么问题。首先我要举一个垃圾邮件分类的例子。

假如你想建立一个垃圾邮件分类器，看这些垃圾邮件与非垃圾邮件的例子（左侧是垃圾邮件，右侧是非垃圾邮件）：

![](/img/16_12_18/001.png)

#### 建立特征向量

左侧这封邮件想要向你推销某个商品。注意这封垃圾邮件有意的拼错一些单词，例如`w4tchs`,`Med1cine`。右边的邮件显然不是一个垃圾邮件。假设我们已经有一些加过标签的训练集，包括标注的垃圾邮件（`y=1`）和非垃圾邮件(`y=0`)。我们如何以监督学习的方法来构造一个分类器来区分垃圾邮件和非垃圾邮件呢？

为了应用监督学习，我们首先必须确定的是如何用邮件的特征构造向量$x$。给出训练集中的特征$x$和标签$y$，我们就能够训练出某种分类器，比如用逻辑回归的方法。

- $x = features\ of\ email\ (邮件的特征)$
- $y = spam(1)\ or\ not\ spam(0)\ (是否为垃圾邮件：1是、0否)$

这里有一种选择邮件的一些特征变量的方法，比如说我们可能会想出一系列单词，我们可以认为这些单词能够用来区分垃圾邮件或非垃圾邮件。

比如说，如果有封邮件，包含单词`deal`，那么它就很有可能是一封垃圾邮件，同时包含单词`buy`的邮件也很有可能是一封垃圾邮件，包含`discount`的邮件也很有可能是垃圾邮件。

如果一封邮件中包含了我的名字，这有可能是一个知道我的人写的，说明这封邮件不太可能是垃圾邮件。因为某些原因，我认为`now`这个单词表明了这封邮件可能并不是垃圾邮件，因为我经常收到一些很紧急的邮件，当然还有别的单词。我们可以选出这样成百上千的单词。

给出一封这样的邮件：

![](/img/16_12_18/002.png)

我们可以将这封邮件用一个特征向量来表示，方法如下：

首先根据字母顺序排序列出我之前选好的单词：

`andrew`,`buy`,`deal`,`discount`,...,`now`,...

然后对当前这封邮件检查一下这些词汇是否出现在这封邮件中。

我用一个特征向量x来表示这些词汇是否出现在了邮件中：

$$
x=
\begin{bmatrix}
   0(andrew) \\\\
   1(buy) \\\\
   1(deal) \\\\
   0(discont) \\\\
   ... \\\\
   1(now) \\\\
   ...
\end{bmatrix}
$$

在这个例子中，我选择了100个词用于表示是否可能为垃圾邮件，所以这个特征向量的维度是100。

并且:

$$
x\_{j} = 
\begin{matrix}
   1\ 如果单词出现在email中 \\\\
   0\ 如果单词没出现在email中
\end{matrix}
$$

这样我们就可以用特征向量来表示这封邮件。

顺便说一句，虽然我所描述的这个过程是我自己选取的100个词，但是在实际工作中最普遍的做法是遍历整个训练集，然后在训练集中选出出现次数最多的n个单词，n一般介于10000到50000之间。然后把这些词作为你要用的特征，因此不同于手动选取，我们只用遍历训练样本，然后选出出现频率最高的词语。这些单词会构成特征，这样你就可以使用它们来做垃圾邮件分类了。

#### 从何处入手来提高分类准确度？

如果你正在构造一个垃圾邮件分类器，你应该会面对这样一个问题，那就是：

**你最该去使用哪一种改进你的方法，从而使得你的垃圾邮件分类器具有较高的准确度？**

##### 积累大量数据

从直觉上讲，是要收集大量的数据。事实上确实好多人这么做，很多人认为收集越多的数据，算法就会表现的越好。事实上就垃圾邮件分类而言，有一个叫做**“Honey  Pot”**的项目，它可以建立一个假的邮箱地址，故意将这些地址泄露给发垃圾邮件的人，这样就能收集到大量的垃圾邮件了。这样的话我们就能得到非常多的垃圾邮件来训练学习算法了。

##### 从email的header中提取路径等信息

但是在前面的课程中我们知道，大量的数据可能会有帮助，但也可能没有。对于大部分的机器学习问题，还有很多办法用来提升机器学习效果。比如对于垃圾邮件来说，也许你会想到用更复杂的特征变量，像是邮件的路径信息（这种信息通常会出现在邮件的标题中）。因此，垃圾邮件发送方在发送垃圾邮件时，他们总会试图让这个邮件的来源变得模糊一些，或者是用假的邮件标题，或者通过不常见的服务器来发送邮件，用不常用的路由来发送邮件。

因此我们可以通过邮件的标题部分来构造更加复杂的特征，来获得一系列的邮件路由信息，进而判定是不是一封垃圾邮件。

##### 从email的正文中提取特征

你可能还会想到别的方法，比如从邮件的正文出发，寻找一些复杂点的特征，例如单词`discount`是否和单词`discounts`是一样的，又比如单词`deal`和`dealer`是否也应视为等同？甚至像这个例子中有的单词小写，有的单词大写。或者我们是否应该用标点符号来构造复杂的特征变量，因为垃圾邮件可能更多的使用感叹号。

##### 构建错词识别算法，来区分邮件中恶意拼写错误的单词

同样的，我们也可能构造更加复杂的算法来检测或者纠正那些故意的拼写错误 ，例如`m0rtgage`,`med1cine`,`w4tches`。因为垃圾邮件发送方确实这么做了，因为如果你将4放到`w4tches`中,那么用我们之前提到的简单的方法，垃圾邮件分类器不会把`w4tches`和`watches`看成一样的，这样我们就很难区分这些故意拼错的垃圾邮件。发垃圾邮件的也很机智，他们这么做就逃避了一些过滤。

---

当我们使用机器学习时，总是可以“头脑风暴”一下，想出一堆方法来试试，就像这样。顺带一提，我有一段时间研究过垃圾邮件分类的问题，尽管我能够理解垃圾邮件分类的问题，我确实懂一些这方面的东西，但是我还是很难告诉你，这四种方法中，你最该去使用哪一种。

事实上，坦白地说，最常见的情况是：一个研究小组，可能会随机确定其中的一个方法，但是有时候，这种方法并不是最有成效的。你知道，你只是随机选择了其中的一种方法。**实际上，当你需要通过头脑风暴来想出不同方法来尝试去提高精度的时候，你可能已经超越了很多人了。令人难过的是，大部分人他们并不尝试着列出可能的方法。**他们做的只是某天早上醒来，因为某些原因，有了一个突发奇想："让我们来试试 用Honey Pot项目 收集大量的数据吧"。不管出于什么奇怪的原因，早上的灵机一动，还是随机选一个，然后干上大半年。

但是我觉得我们有更好的方法，是的，我们将在随后的课程中讲到这个，那就是**误差分析**。

我会告诉你，**怎样用一个更加系统性的方法从一堆不同的方法中选取合适的那一个。**因此，你更有可能选择一个真正的好方法，能让你花上几天几周甚至是几个月去进行深入的研究。

## 误差分析，几个小窍门

[视频地址](https://www.coursera.org/learn/machine-learning/lecture/x62iE/error-analysis)

在上一节课中，我讲到应当怎样面对机器学习问题，有很多提高算法表现的方法，在本次课程中，我们将会讲到**误差分析(error analysis)**的概念。这会帮助你更系统地做出决定。

### **推荐方法：**

- 1.以一个你可以快速实现的简单的算法作为开始。实现它并且在交叉验证数据集上进行测试。

> 如果你准备研究机器学习的东西，或者构造机器学习应用程序，最好的实践方法不是建立一个非常复杂的系统，拥有那么多复杂的变量，而是构建一个简单的算法，这样你可以很快地实现它。

- 2.绘制出学习曲线来进而决定是否需要更多的数据，或者更多的特征，等等。

- 3.误差分析：主要检查出在你的算法下，有误差的（在交叉验证集中的）样本数据。

### **错误分析：**

$m\_{cv}=500$个在交叉验证集中的样本。

算法错误的分类了100封邮件。

手工的检查这100个错误邮件，然后基于下面两个条件重新进行分类：

- (i) 它们是什么类别的邮件
> 如果你发现算法对于某个类别的分类区分的很差（比如说大部分的错误分类的邮件其实都属于**钓鱼邮件**这种类别，就证明算法对钓鱼邮件的识别很差）这说明，你应该花更多时间来研究这种类型的邮件。然后看看你是否能通过构造更好的特征变量来正确区分这种类型的邮件。
- (ii) 看看哪些特征变量可能会帮助算法正确地分类邮件
> 比如说查看邮件分别属于**故意拼写错误**、**不正常的来源**、**有垃圾邮件特有的标点符号**，如果你发现在错误分类的邮件中，很少有**故意拼写错误**的情况，那么你就可以不用花太多时间在这一类别上了。如果你发现**有垃圾邮件特有的标点符号**这种类别的邮件很多，那么这就是一个很强的特征，说明你应该花费时间在这种类别的分类上。


这种类型的误差分析是一种手动检测的过程，检测算法可能会犯的错误，这通常能够帮你找到更为有效的手段。这也解释了为什么我总是推荐先实践一种快速但不完美的算法。

我们真正想要的是找出什么类型的邮件，是这种算法最难分类出来的，对于不同的机器学习算法，它们所遇到的问题一般总是相同的。通过实现一些快速即便不完美的算法，你能够更快地找到错误的所在，并且快速找出算法难以处理的例子。这样你就能集中精力在这些真正的问题上。

### **数值计算的方式来评估你的机器学习算法：**

如果你在构造一个学习算法，如果你能有一种评估你算法的方法，这将是非常有用的。

假设我们试图决定是否把像"discount","discounts","discounter","discountring"这样的单词都视为等同。

一种方法是检查这些单词的开头几个字母，比如检查"discoun"这几个字母，认为以这几个字母开头的单词大概可能有着相同的意思。

> 在自然语言处理中，这种方法是通过一种叫做**词干提取**的软件实现的。如果你想自己来试试，你可以在网上搜索**"Porter
 Stemmer(波特词干提取法)"**，这是在词干提取方面一个比较不错的软件。这个软件会将单词"discount"、"discounts"等词视为同一个单词。
>
> 但是这类词干提取软件只会检查单词的开头几个字母，这虽然有用，但也可能会造成一些问题。举个例子，这个软件会把单词"universe(宇宙)"和"university(大学)"也视为同一个单词，因为他们的开头是一样的。
 
因此，当你在决定是否应该使用词干提取软件来分类时，这总是很难说清楚到底是好还是坏。特别地，**误差分析**也并不能帮助你决定词干提取是不是一个好的方法。

与之相对地最好的方法来发现词干提取软件对你的分类器到底有没有用，是迅速的着手试一试，来看看它表现到底怎么样。

为了这么做，通过数值来评估你的算法是非常有用的，具体的说，自然而然地你应该通过**交叉验证**来验证不用词干提取与用词干提取的算法的错误率。

因此，如果你不在你的算法中使用词干提取，然后你得到比如5%的分类错误率，然后你再使用词干提取来运行你的算法，你得到比如3%的分类错误率，那么这很大的减少了错误的发生，于是你决定词干提取是一个好方法。

就这个特定的问题而言，这里有一个数量的评估数字，即**交叉验证错误率**。我们以后会发现这个例子中的评估数字还需要一些处理，但是我们可以在今后的课程中看到这么做还是会让你能更快地做出决定，比如是否使用词干提取。

---

### 总结一下

当你在研究一个新的机器学习问题时，我总是推荐你实现一个较为简单快速即便不是那么完美的算法，我几乎从未见过人们是这样做。大家经常干的事情是花费大量的时间在构造算法上，构造他们以为的简单的方法，因此，不要担心你的算法太简单，或者太不完美，而是尽可能快地实现你的算法，当你有了初始的实现之后，它会变成一个非常有力的工具，来帮助你决定下一步的做法。因为我们可以先看看算法造成的错误，通过误差分析来看看它犯了什么错，然后来决定优化的方式。

另一件事，假设你有了一个快速而不完美的算法实现，又有一个数值的评估数据，这会帮助你尝试新的想法快速地发现你尝试的这些想法是否能够提高算法的表现。从而你会更快地做出决定，在算法中放弃什么，吸收什么。
 
 



